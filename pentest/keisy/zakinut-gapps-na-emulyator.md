# Закинуть GApps на эмулятор

## Устанавливаем сервисы Google Play для эмулятора.

1. Скачиваем GApp'сы [http://opengapps.org/](http://opengapps.org/) 
2. Копируем архив в папку где будете с ней работать и переходим в эту папку в терминале
3. Распаковываем архив. Создаем скрипт extract.sh Даем ему права на выполнения

   ```text
   chmod +x extract.sh
   ```

   сам скрипт:

   ```text
   unzip open_gapps-x86_64-9.0-stock-20200403.zip 'Core/*'
   rm Core/setup*
   lzip -d Core/*.lz
   for f in $(ls Core/*.tar); do
   tar -x --strip-components 2 -f $f
   done
   ```

4. запускаем скрипт

   ```text
   sh extract.sh
   ```

5. если в системе не определена переменная ANDROID\_SDK редактируем профиль

   ```text
   nano ~/.bash_profile
   ```

6. определяем переменные

   ```text
   export ANDROID_SDK=$HOME/Library/Android/sdk
   export PATH=$ANDROID_SDK/emulator:$ANDROID_SDK/tools:$PATH
   ```

   и сохраняем

7. перезапускаем bash

   ```text
   . ~/.bash_profile
   ```

8. стартуем эмулятор

   ```text
   $ANDROID_SDK/emulator/emulator @<EMULATOR> -writable-system &
   ```

9. далее ставим пакеты

   ```text
   adb root
   adb remount
   adb push etc /system
   adb push framework /system
   adb push app /system
   adb push priv-app /system
   ```

10. перезапускаем

    ```text
    adb shell stop
    adb shell start
    ```

## Решение проблемы синхронизации контактов с Google аккаунтом на эмуляторе

Для решения проблемы синхронизации контактов из Google аккаунта на эмуляторе нужно выполнить следующие шаги: 

1\) Зайти на [https://opengapps.org](https://opengapps.org) и скачать сервисы. 

Для скачивания нужной версии сервисов нужно выбрать платформу и версию Android. Варианта сборки pico будет достаточно. 

2\) Заходим в open\_gapps-\[platform\]-\[android version\]/Core и распаковываем googlecontactssync-all.tar.

 В папке googlecontactssync-all/nodpi/app/GoogleContactsSyncAdapter будет лежать нужный нам APK GoogleContactsSyncAdapter.apk. 

3\) Запускаем эмулятор \(обязательно с параметром writable, иначе не получится положить APK сервиса в системную папку\). Команду нужно выполнять из $ANDDOID\_HOME/tools: 

emulator -writable-system -avd \[Emulator name\] -no-snapshot-load -qemu

4\) Далее закидываем GoogleContactsSyncAdapter.apk в системную папку : 

adb remount 

adb push путь/до/апк/GoogleContactsSyncAdapter.apk /system/priv-app/

5\) Перезапускаем устройство: 

adb shell stop && adb shell start 

После перезапуска устройства проблема будет решена.

